{% extends "base.html" %}

{% block title %}
  Analysis
{% endblock %}

{% block body %}

  <label for="genome_genes">Choose Gene:</label>
  <input list="genome_genes" id="gene_list" name="gene_list" />
  <datalist id="genome_genes">
    {% for gene in genes %}
      <option value="{{gene}}">
    {% endfor %}
  </datalist>

  <div class="loader" id="loader"></div>
  <div id="cnv"></div>

<script src="{{ url_for('static', filename='js/jquery-1.11.1.min.js') }}"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<script>
  function renderPlot(plotJSON){
    var config = {"scrollZoom": true};
    Plotly.setPlotConfig(config);
    Plotly.plot("cnv", plotJSON,{});
    /*Plotly.newPlot("cnv", plotJSON,{});*/
  }
</script>
<script>
  /*Load CNV Plot on startup.*/
  $(document).ready(function(){
      $.ajax({
          url: "/cnv",
          type: "GET",
          contentType: "application/json;charset=UTF-8",
          data: {
            "samp": "{{sample_name}}",
            "genes": "", 
          },
          dataType:"json",
          success: function (data) {
              document.getElementById("loader").style.display = "none";
              renderPlot(data);
          }
      });
  })
</script>
<script>
  /*Reload CNV Plot when genes are chosen.*/
  $("#gene_list").on("change",function(){
      $.ajax({
          url: "/cnv",
          type: "GET",
          contentType: "application/json;charset=UTF-8",
          data: {
            "samp": "{{sample_name}}",
            "genes": document.getElementById("gene_list").value
          },
          dataType:"json",
          success: function (data) {
              renderPlot(data);
          }
      });
  })
</script>

{% endblock %}
